## ZSMD-1A02-S1模块操作手册&说明书

####   功能概述

- 多路Socket连接（目前支持两路，最高可扩展至6路），TCP连接；
- 支持 GPRS 网络；支持 2G/3G/4G 手机卡的 2G 流量 ；
- 支持发送心跳包数据； 
- 支持串口设置模块参数； 
- 支持多种工作模式：数据透传模式、协议包模式；
- 支持修改模块串口波特率；
- 主动推送模块当前信号强度；
- 支持域名连接；

#### 快速入门

ZSMD-1A02-S1是为实现串口设备与网络服务器，通过 GPRS 网络相互传输数据而开发的产品，通过私有的ZS-Protocol进行设置，即可轻松使用本产品实现串口到网络的双向数据透明传输。本章是针对 ZSMD-1A02-S1 产品的快速入门介绍，建议新用户仔细阅读本章并按照指示操作一遍，以对本产品有一个系统的认识。熟悉此类产品用户可跳过本章节。针对特定的细节和说明，请参考后续章节。

本模块支持两路 Socket 连接，分别为 Socket 0 ， Socket 1， 它们是相互独立的。ZSMD-1A02-S1 仅支持作为 TCP Client 。 

本章主要测试ZSMD-1A02-S1的网络透传功能，即实现串口端与 TCP Server 端的数据传输。
涉及到的相关资料和软件：
串口调试软件：SSCOM5.1
网络调试助手：TCPUDPDbg

#### 产品测试硬件环境

##### 硬件准备

在测试之前，请按如下图示，进行硬件连接。 

#### 数据传输测试 

##### 模块的初始参数

| 参数类型 | 参数 |
| :--- | ---- |
| 主服务器使能 | √ |
| 主服务器端口 | 56527 |
| 主服务器地址 | 103.46.128.43         |
| 主服务器域名 | 2246j73i62.imwork.net |
| 主服务器连接方式 | IP连接 |
| 备用服务器使能 | √ |
| 备用服务器端口 | 56527 |
| 备用服务器地址 | 103.46.128.43 |
| 备用服务器域名 | 2246j73i62.imwork.net |
| 备用服务器连接方式 | IP连接 |
| 工作模式 | 透传模式 |
| 串口参数 | 115200,8,1,None |
| 心跳包 | ×                     |

* 向卡槽内放置 SIM 卡，用上述的连接方式连接到电脑串口。
* 给模块插上12V电源适配器进行供电，3秒后模块D15的红色LED将开始闪烁，表示模块已经开始工作。
* 串口等待模块发送协议包模式的信号强度命令，表示模块已经初始化成功。
* 通过 RS232 串口，给模块发送数据，例如，发送“hello”，稍后， 会在网络调试助手软件的接收窗口，收到“hello”，测试成功。 
#### 工作模式 

##### 数据透传模式

模式说明：

在此模式下，用户的串口设备，可以通过向本模块发送数据到第一路连接。模块也可以接受来自服务器的数据，并将信息转发至串口设备。用户不需要关注串口数据与网络数据包之间的数据转换过程，只需通过支持ZS-Protocol协议格式的数据包进行数据传输或者参数配置（见下章），即可实现串口设备与网络服务器之间的数据透明通信。

数据传输测试：

* Rssi：17
* 串口参数：115200  8 1 None

| 字节数 | 入出队平均时间（从串口发出数据到发送成功之间的时间） |
| ------ | ---------------------------------------------------- |
| 1      | 130ms                                                |
| 10     | 130ms                                                |
| 100    | 165ms                                                |
| 200    | 165ms                                                |
| 500    | ×                                                    |
建议：每条数据之间发送时间间隔控制在180m以上 。 大小目前只支持每条300byte以下。

##### 协议包模式

**模式说明**：

在此模式下，用户可以根据ZS-Protocol协议，配置相应的数据包或者参数包，来自定义模块参数和数据发送对象。用户需要将自己的数据或者进行组包来实现模块不同的功能，相当灵活。目前支持数据包，参数配置包和参数请求包。

**数据传输：**

在包模式下，串口与模块之间通讯，需要将传输的数据段通过ZS-Protocol协议进行组包，由模块进行协议转换以及数据发送。

**一个标准的数据包**（0x）：

5a 0f 00 00  08 00 84 00 68 65 6C 6C 6F 00 53

| 值             | 说明                         |
| -------------- | ---------------------------- |
| 5a             | 帧头，字符'Z'                |
| 0f 00          | 数据包长，从帧头到帧尾，小端 |
| 00 08          | 控制域， Trans位置1，小端    |
| 00             | seq                          |
| 84             | cmd (非标准)                 |
| 00             | socket号，00表示socket0      |
| 68 65 6C 6C 6F | 数据段,'hello'               |
| 00             | 和校验位                     |
| 53             | 帧尾，字符'S'                |
|                |                              |

说明：向Socket0发送“hello”5个字节的数据。

**数据传输测试**：

- Rssi：17
- 串口参数：115200  8 1 None

| 字节数 | 入出队平均时间（从串口发出数据到发送成功之间的时间） |
| ------ | ---------------------------------------------------- |
| 1      | 145ms                                                |
| 10     | 145ms                                                |
| 100    | 165ms                                                |
| 200    | 165ms                                                |
| 500    | ×                                                    |

建议：每条数据之间发送时间间隔控制在180m以上 。 大小目前只支持每条300byte以下。



#### 参数设置

不论工作在数据透传模式还是协议包模式，模块的参数配置都是通过串口向模块发送ZS-Protocol支持的协议包进行模块的参数配置。

**一个包含所有配置命令的参数配置包**（0x）：

5a 5600 0100 0082 0d 010101 020100 0304672E802B 0402CFDC 050E7777772E6E6A7A6868622E636F6D 060101 070100 0804672E802B 0902CFDC 0a0e7777772E6E6A7A6868622E636F6D 0b0400C201000 C0101 0D0100 00 53

| 值                               | 说明                                                         |
| -------------------------------- | ------------------------------------------------------------ |
| 5a                               | 帧头，字符'Z'                                                |
| 5600                             | 数据包长，从帧头到帧尾，小端                                 |
| 0100                             | 控制域， Ack位置1，小端                                      |
| 00                               | seq                                                          |
| 82                               | cmd (非标准)                                                 |
| 0d                               | 配置的命令的条数                                             |
| 010101                           | 主服务器使能控制  vlaue：01使能，00失能     TLV格式（下同）  |
| 020100                           | 主服务器连接方式  vlaue：01域名连接，00IP地址连接            |
| 0304672E802B                     | 主服务器IP地址  672E802B表示103.46.128.43  743E6664表示116.62.102.100   小端 |
| 0402CFDC                         | 主服务器端口号 B036表示14000 CFDC表示56527 小端              |
| 050E7777772E6E6A7A6868622E636F6D | 主服务器域名 7777772E6E6A7A6868622E636F6D                          "www.njzhhb.com" |
| 060101                           | 主服务器使能控制  vlaue：01使能，00失能     TLV格式（下同）  |
| 070100                           | 主服务器连接方式  vlaue：01域名连接，00IP地址连接            |
| 0804672E802B                     | 主服务器IP地址  672E802B表示103.46.128.43  743E6664表示116.62.102.100   小端 |
| 0902CFDC                         | 主服务器端口号 B036表示14000 CFDC表示56527 小端              |
| 0a0e7777772E6E6A7A6868622E636F6D | 主服务器域名 7777772E6E6A7A6868622E636F6D                          "www.njzhhb.com" |
| 0b0400C201000                    | 波特率  115200  小端                                         |
| C0101                            | 工作模式  01协议包模式  00数据透传模式                       |
| 0D0100                           | 心跳包  00关闭 01开启                                        |
| 00                               | 和校验位（00仅测试）                                         |
| 53                               | 帧尾，字符'S'                                                |

**应答包**

5A 57 00 40 00 33 81 01 0D 01 01 01 02 01 00 03 04 67 2E 80 2B 04 02 CF DC 05 0E 77 77 77 2E 6E 6A 7A 68 68 62 2E 63 6F 6D 06 01 01 07 01 00 08 04 67 2E 80 2B 09 02 CF DC 0A 0E 77 77 77 2E 6E 6A 7A 68 68 62 2E 63 6F 6D 0B 04 00 C2 01 00 0C 01 01 0D 01 00 8A 53 

| 值                               | 说明                                                         |
| -------------------------------- | ------------------------------------------------------------ |
| 5a                               | 帧头，字符'Z'                                                |
| 57 00                            | 数据包长，从帧头到帧尾，小端                                 |
| 4000                             | 控制域， Ack位置1，小端                                      |
| 33                               | seq                                                          |
| 82                               | cmd (非标准)                                                 |
| 0d                               | 配置的命令的条数                                             |
| 010101                           | 主服务器使能控制  vlaue：01使能，00失能     TLV格式（下同）  |
| 020100                           | 主服务器连接方式  vlaue：01域名连接，00IP地址连接            |
| 0304672E802B                     | 主服务器IP地址  672E802B表示103.46.128.43  743E6664表示116.62.102.100   小端 |
| 0402CFDC                         | 主服务器端口号 B036表示14000 CFDC表示56527 小端              |
| 050E7777772E6E6A7A6868622E636F6D | 主服务器域名 7777772E6E6A7A6868622E636F6D                          "www.njzhhb.com" |
| 060101                           | 主服务器使能控制  vlaue：01使能，00失能     TLV格式（下同）  |
| 070100                           | 主服务器连接方式  vlaue：01域名连接，00IP地址连接            |
| 0804672E802B                     | 主服务器IP地址  672E802B表示103.46.128.43  743E6664表示116.62.102.100   小端 |
| 0902CFDC                         | 主服务器端口号 B036表示14000 CFDC表示56527 小端              |
| 0a0e7777772E6E6A7A6868622E636F6D | 主服务器域名 7777772E6E6A7A6868622E636F6D                          "www.njzhhb.com" |
| 0b0400C201000                    | 波特率  115200  小端                                         |
| C0101                            | 工作模式  01协议包模式  00数据透传模式                       |
| 0D0100                           | 心跳包  00关闭 01开启                                        |
| 8A                               | 和校验位（00仅测试）                                         |
| 53                               | 帧尾，字符'S'                                                |

#### 参数获取

只有在协议包模式下，往串口发送参数获取的协议包，模块会通过协议包格式返回目前的运行参数。

**一个标准的参数获取包(0x)：**

5a 09 00 01 00 00 80 00 53

| 值    | 说明                         |
| ----- | ---------------------------- |
| 5a    | 帧头，字符'Z'                |
| 09 00 | 数据包长，从帧头到帧尾，小端 |
| 00 01 | 控制域， Ack位置1，小端      |
| 00    | seq                          |
| 80    | cmd (非标准)                 |
| 00    | 和校验位                     |
| 53    | 帧尾，字符'S'                |
|       |                              |

**应答包**

5A 57 00 40 00 33 81 01 0D 01 01 01 02 01 00 03 04 67 2E 80 2B 04 02 CF DC 05 0E 77 77 77 2E 6E 6A 7A 68 68 62 2E 63 6F 6D 06 01 01 07 01 00 08 04 67 2E 80 2B 09 02 CF DC 0A 0E 77 77 77 2E 6E 6A 7A 68 68 62 2E 63 6F 6D 0B 04 00 C2 01 00 0C 01 01 0D 01 00 8A 53 

说明：与前章参数配置的应答包相同

#### 信号强度包

在包模式下，开启心跳包模式，模块会每隔5秒返回一次模块当前的信号强度。此功能在透传模式下无效。

5A 0D 00 00 00 91 86 01 15 01 13 4E 53 

| 值          | 说明                              |
| ----------- | --------------------------------- |
| 5a          | 帧头，字符'Z'                     |
| 0d 00       | 数据包长，从帧头到帧尾，小端      |
| 00 00       | 控制域， Ack位置1，小端           |
| 91          | seq                               |
| 86          | cmd (非标准)                      |
| 01 15 01 13 | TLV Count 1byte, Tag  Len  Value. |
| 00          | 和校验位                          |
| 53          | 帧尾，字符'S'                     |
|             |                                   |


